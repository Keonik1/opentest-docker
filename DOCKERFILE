FROM ibmjava:8-jre as base
# ARG http_proxy=http://172.17.0.1:3128
# ARG https_proxy=http://172.17.0.1:3128
ENV LANG=en_US.UTF-8

WORKDIR /tmp/node
RUN echo 'APT::Install-Recommends "0";' > /etc/apt/apt.conf.d/01norecommend && \
echo 'APT::Install-Suggests "0";' >> /etc/apt/apt.conf.d/01norecommend && \
apt update && \
apt install -y \
    sudo \
    wget \
    curl \
    sudo \
    ca-certificates && \
DEBIAN_FRONTEND=noninteractive \
TZ=Europe/London \
apt install -y tzdata && \
apt install -y locales && \
sed -i -e "s/# $LANG.*/$LANG UTF-8/" /etc/locale.gen && \
dpkg-reconfigure --frontend=noninteractive locales && \
update-locale LANG=$LANG \
&& rm -rf /var/lib/apt/lists/*

RUN curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash - && \
apt-get install -y nodejs && \
rm -rf ../node && \
rm -rf /var/lib/apt/lists/*
WORKDIR /opt/opentest
RUN npm config set registry http://registry.npmjs.org/ && \
npm install opentest -g && \
opentest quick-start
# npm --proxy "http://192.168.56.80:3128" install opentest -g && \

FROM base as Server
ENTRYPOINT [ "opentest", "server", "./server" ]

FROM base as Actor
ENTRYPOINT [ "opentest", "actor", "./actor1" ]

